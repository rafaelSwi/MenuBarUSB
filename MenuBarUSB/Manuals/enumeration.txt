MenuBarUSB implements a structured enumeration mechanism to identify all USB devices currently recognized by the macOS I/O subsystem. This process begins by issuing class-matching queries to the I/O Registry, specifically targeting known USB-related service classes such as IOUSBHostDevice and legacy USB device classes exposed by the kernel. For each matching class, the system retrieves an iterator that provides access to registry entries representing active USB devices and interfaces.

Each entry is interrogated through IORegistryEntryCreateCFProperties to obtain a property dictionary containing vendor identifiers, product identifiers, device descriptors, and other low-level metadata. From these attributes, the software derives a unique identifier for each device, ensuring that instances representing the same physical hardware are not duplicated across different registry queries or enumeration passes.

Because macOS may expose multiple logical representations of a single USB device through layered controller or interface nodes, the software maintains an internal set of encountered device identifiers. Any newly enumerated device is compared against this set; only entries whose identifiers have not been previously recorded are added to the final device list. This consolidation step guarantees that the enumeration output reflects a unified and non-redundant representation of all connected USB devices.

The result is a normalized, deduplicated list that serves as the authoritative source for downstream processes such as speed reporting, event monitoring, device classification, and notification handling.
